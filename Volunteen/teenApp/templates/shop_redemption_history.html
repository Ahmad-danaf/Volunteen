{% extends 'shop_base.html' %}
{% load static %}
{% block title %}Shop Home{% endblock %}

{% block content %}
<h2>Welcome {{ shop.name }}</h2>

<div>
    <h3>Recent Redemptions</h3>
    <table class="redemption-table">
        <thead>
            <tr>
                <th>Date Redeemed</th>
                <th>Child</th>
                <th>Points Redeemed</th>
            </tr>
        </thead>
        <tbody>
            {% if recent_redemptions %}
            {% for redemption in recent_redemptions %}
            <tr>
                <td>{{ redemption.date_redeemed }}</td>
                <td>{{ redemption.child.user.username }}</td>
                <td>{{ redemption.points_used }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3">No recent redemptions.</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="3">No recent redemptions.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div class="section">
    <h3>Monthly Redemption Summary</h3>
    <div class="chart-container">
        <canvas id="redemptionChart"></canvas>
    </div>
    {% if monthly_redemptions %}
    <table class="redemption-summary-table">
        <thead>
            <tr>
                <th>Month</th>
                <th>Max Points</th>
                <th>Points Used</th>
            </tr>
        </thead>
        <tbody>
            {% for redemption in monthly_redemptions %}
            <tr>
                <td>{{ redemption.month|date:"F Y" }}</td>
                <td>{{ redemption.max_points }}</td>
                <td>{{ redemption.total_points }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No monthly redemption data available.</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/shop_redemption_history.css' %}">
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/shop_redemption_history.js' %}"></script>
{% endblock %}
