{% extends 'mentor_primary_base.html' %} 
{% load static %}
{% block title %}מחיקת קבוצת משימות - {{ task_group.name }}{% endblock %}
{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          hebrew: ["Arial", "Tahoma", "sans-serif"],
        },
      },
    },
  };
</script>
<style>
  .rtl {
    direction: rtl;
  }
</style>
{% endblock %}
{% block content %}
<div class="min-h-screen bg-gradient-to-br from-red-50 to-orange-100 p-4 rtl">
  <div class="max-w-md mx-auto">
    <!-- Header -->
    <div
      class="bg-white rounded-xl shadow-lg p-6 mb-6 border-r-4 border-red-500"
    >
      <div class="flex items-center mb-4">
        <a
          href="{% url 'mentorApp:task_group_detail' task_group.id %}"
          class="ml-3 p-2 rounded-full hover:bg-gray-100 transition-colors"
        >
          <i class="fas fa-arrow-right text-gray-600"></i>
        </a>
        <div
          class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center ml-3"
        >
          <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-red-800 font-hebrew">מחיקת קבוצה</h1>
      </div>
      <p class="text-red-600 font-hebrew">פעולה זו לא ניתנת לביטול!</p>
    </div>

    <!-- Warning Card -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="text-center mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-2 font-hebrew">
          האם אתה בטוח שברצונך למחוק את הקבוצה?
        </h2>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-right">
          <h3 class="font-bold text-red-800 text-lg font-hebrew">
            {{ task_group.name }}
          </h3>
          {% if task_group.description %}
          <p class="text-red-600 text-sm mt-1 font-hebrew">
            {{ task_group.description }}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- Impact Summary -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
        <h3 class="font-bold text-yellow-800 text-sm mb-3 font-hebrew">
          <i class="fas fa-info-circle ml-2"></i>
          מה יקרה בעת המחיקה:
        </h3>
        <ul class="space-y-2 text-sm text-yellow-700 font-hebrew">
          <li class="flex items-center">
            <i class="fas fa-check-circle text-yellow-500 ml-2 w-4"></i>
            הקבוצה תימחק לצמיתות
          </li>
          <li class="flex items-center">
            <i class="fas fa-check-circle text-yellow-500 ml-2 w-4"></i>
            {{ task_count }} משימות יוסרו מהקבוצה
          </li>
          <li class="flex items-center">
            <i class="fas fa-times-circle text-red-500 ml-2 w-4"></i>
            המשימות עצמן לא יימחקו
          </li>
          <li class="flex items-center">
            <i class="fas fa-times-circle text-red-500 ml-2 w-4"></i>
            החניכים שהוקצו למשימות יישארו מוקצים
          </li>
        </ul>
      </div>

      <!-- Group Stats -->
      {% if task_count > 0 %}
      <div class="bg-gray-50 rounded-lg p-4 mb-6">
        <h3 class="font-bold text-gray-700 text-sm mb-3 font-hebrew">
          <i class="fas fa-chart-bar ml-2"></i>
          פרטי הקבוצה
        </h3>
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div class="text-center bg-white rounded-lg p-3">
            <div class="font-bold text-gray-800 text-lg">{{ task_count }}</div>
            <div class="text-gray-600 font-hebrew">משימות</div>
          </div>
          <div class="text-center bg-white rounded-lg p-3">
            <div class="font-bold text-gray-800 text-lg">
              {{ task_group.created_at|date:"d/m" }}
            </div>
            <div class="text-gray-600 font-hebrew">נוצר</div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Confirmation Form -->
      <form method="post" class="space-y-4">
        {% csrf_token %}

        <!-- Confirmation Checkbox -->
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <label class="flex items-start cursor-pointer">
            <input
              type="checkbox"
              id="confirm_delete"
              required
              class="mt-1 ml-3 w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"
            />
            <span class="text-sm text-red-800 font-hebrew">
              אני מבין שמחיקת הקבוצה היא פעולה בלתי הפיכה ואישור את המחיקה של
              <strong>"{{ task_group.name }}"</strong>
            </span>
          </label>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col space-y-3 pt-4">
          <button
            type="submit"
            id="delete_btn"
            disabled
            class="w-full bg-red-500 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center justify-center"
          >
            <i class="fas fa-trash ml-2"></i>
            מחק קבוצה לצמיתות
          </button>

          <a
            href="{% url 'mentorApp:task_group_detail' task_group.id %}"
            class="w-full bg-gray-100 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center"
          >
            <i class="fas fa-arrow-right ml-2"></i>
            ביטול - חזור לקבוצה
          </a>
        </div>
      </form>
    </div>

    <!-- Safety Tip -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="font-bold text-gray-800 text-sm mb-3 font-hebrew">
        <i class="fas fa-shield-alt text-green-500 ml-2"></i>
        חלופה למחיקה
      </h3>
      <p class="text-sm text-gray-600 mb-3 font-hebrew">
        במקום למחוק, תוכל לסמן את הקבוצה כ"לא פעילה" בעריכה
      </p>
      <a
        href="{% url 'mentorApp:edit_task_group' task_group.id %}"
        class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors text-sm font-hebrew"
      >
        <i class="fas fa-edit ml-2"></i>
        עבור לעריכת הקבוצה
      </a>
    </div>
  </div>
</div>

<script>
  // Enable/disable delete button based on confirmation checkbox
  document.getElementById('confirm_delete').addEventListener('change', function() {
      const deleteBtn = document.getElementById('delete_btn');
      deleteBtn.disabled = !this.checked;

      if (this.checked) {
          deleteBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
          deleteBtn.classList.add('bg-red-500', 'hover:bg-red-600');
      } else {
          deleteBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
          deleteBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
      }
  });

  // Double confirmation on form submit
  document.querySelector('form').addEventListener('submit', function(e) {
      if (!confirm('האם אתה בטוח לחלוטין? פעולה זו לא ניתנת לביטול!')) {
          e.preventDefault();
      }
  });

  // Show messages
  {% if messages %}
      {% for message in messages %}
          setTimeout(() => {
              const alert = document.createElement('div');
              alert.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-lg text-white font-medium ${message.tags === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
              alert.textContent = '{{ message }}';
              document.body.appendChild(alert);

              setTimeout(() => {
                  alert.remove();
              }, 4000);
          }, 100);
      {% endfor %}
  {% endif %}
</script>
{% endblock %}
